/**
 * @fileOverview php_bs_grid is a jQuery helper plugin for php_bs_grid class. Project page https://github.com/pontikis/php_bs_grid
 * @version 0.9.4 (20 Jun 2017)
 * @licence MIT
 * @author Christos Pontikis http://www.pontikis.net
 * @copyright Christos Pontikis http://www.pontikis.net
 */
"use strict";!function(a){var e="php_bs_grid",t={init:function(t){var r=this;return this.each(function(){var _=r.data(e);if("undefined"==typeof _){var i=r.php_bs_grid("getDefaults");_=a.extend({},i,t)}else _=a.extend({},_,t);r.data(e,_);var o,l,s,p,c,n,d,m,u,h,v,f,k,g=a("#"+_.php_bs_grid_form_id),b=a("#"+_.reset_all_id),w=a("#"+_.rows_per_page_id),x=a("#"+_.columns_switcher_id),y=a("#"+_.columns_to_display_id),j=a("#"+_.addnew_record_id),I=a("#"+_.sort_simple_field_id),D=a("#"+_.sort_simple_order_id),O=a("#"+_.sort_advanced_id),S=a(_.col_sortable_selector),A=a("#"+_.go_top_id),P=a("#"+_.go_back_id),q=a("#"+_.go_forward_id),C=a("#"+_.go_bottom_id),T=a("#"+_.go_to_page_id),z=a("#"+_.page_num_id),Q=a("#"+_.total_pages_id),E=a("#"+_.export_excel_btn_id),M=a("#"+_.export_excel_id),B=a("#"+_.criteria_apply_id),F=a("#"+_.criteria_reset_id),G=a("#"+_.criteria_clear_id),H=a("#"+_.criteria_before_id),J=a("#"+_.criteria_after_id),K=(_.msg_criteria_not_changed,_.msg_apply_or_reset_criteria,_.default_page_num),L=_.columns_default,N=_.columns_more,R=_.export_excel_no,U=_.export_excel_yes,V=_.criteria_operator_text_ignore,W=_.criteria_operator_text_isnull,X=_.criteria_operator_lookup_ignore,Y=_.criteria_operator_lookup_equal,Z=_.criteria_operator_date_ignore,$=_.criteria_operator_date_equal,aa=_.criteria_operator_date_isnull,ea=w.val(),ta=_.criteria,ra=[],_a={error:null,focus:null,text_inputs_contain_value:null,ajax_data_to_pass:{}};a.each(ta,function(e,t){switch(t.type){case"text":ra.push("#"+t.params_html.dropdown_id),ra.push("#"+t.params_html.input_id);break;case"lookup":ra.push("#"+t.params_html.dropdown_id),ra.push("#"+t.params_html.dropdown_lookup_id);break;case"date":ra.push("#"+t.params_html.dropdown_id),ra.push("#"+t.params_html.input_id);break;case"autocomplete":ra.push("#"+t.params_html.autocomplete_id),ra.push("#"+t.params_html.filter_id);break;case"multiselect_checkbox":a.each(t.params_html.items,function(a,e){ra.push("#"+e.input_id)})}}),u=ra.join(","),h=a(u),v=h.serialize(),H.val(v);var ia=function(e){a.each(ta,function(t,r){if(r.type===e)switch(l=a("#"+r.params_html.dropdown_id),e){case"text":o=a("#"+r.params_html.input_id),parseInt(l.val())===W?(o.val(""),o.hide()):(o.show(),parseInt(l.val())===V&&o.val(""));break;case"lookup":o=a("#"+r.params_html.dropdown_lookup_id),parseInt(l.val())===Y?o.show():o.hide();break;case"date":if(o=a("#"+r.params_html.input_id),s=a("#"+r.params_html.wrapper_id),s.is(":visible")){var _=!1;if(r.params_html.hasOwnProperty("associated_criteria_name")&&r.params_html.associated_criteria_name){_=!0;var i=r.params_html.associated_criteria_name,p=ta[i],c=a("#"+p.params_html.wrapper_id),n=a("#"+p.params_html.dropdown_id),d=a("#"+p.params_html.input_id)}var m=parseInt(l.val());m===$||m===aa?(m===aa&&(o.val(""),o.hide()),_&&(n.val(Z),d.val(""),c.hide())):(o.show(),m===Z&&o.val(""),_&&c.show())}}})},oa=function(e){var t=ta[e];switch(t.type){case"text":l=a("#"+t.params_html.dropdown_id),o=a("#"+t.params_html.input_id),l.val(t.params_html.dropdown_value),o.val(t.params_html.input_value);break;case"lookup":l=a("#"+t.params_html.dropdown_id),o=a("#"+t.params_html.dropdown_lookup_id),l.val(t.params_html.dropdown_value),t.params_html.dropdown_lookup_value?o.val(t.params_html.dropdown_lookup_value):o.prop("selectedIndex",0);break;case"date":l=a("#"+t.params_html.dropdown_id),o=a("#"+t.params_html.input_id),l.val(t.params_html.dropdown_value),o.val(t.params_html.input_value);break;case"autocomplete":n=a("#"+t.params_html.filter_id),c=a("#"+t.params_html.autocomplete_id),n.val(t.params_html.filter_value),c.val(t.params_html.autocomplete_value);break;case"multiselect_checkbox":a.each(t.params_html.items,function(e,r){m=a("#"+r.input_id),-1!==jQuery.inArray(parseInt(m.val()),t.params_html.group_value)?m.prop("checked",!0):m.prop("checked",!1)})}},la=function(e){var t=ta[e];switch(t.type){case"text":l=a("#"+t.params_html.dropdown_id),o=a("#"+t.params_html.input_id),o.val(""),l.val(V);break;case"lookup":l=a("#"+t.params_html.dropdown_id),l.val(X);break;case"date":l=a("#"+t.params_html.dropdown_id),o=a("#"+t.params_html.input_id),o.val(""),l.val(Z);break;case"autocomplete":n=a("#"+t.params_html.filter_id),c=a("#"+t.params_html.autocomplete_id),n.val(""),c.val("");break;case"multiselect_checkbox":a.each(t.params_html.items,function(e,t){a("#"+t.input_id).prop("checked",t.default_checked_status)})}},sa=function(){a.each(ta,function(e,t){switch(t.type){case"text":if(l=a("#"+t.params_html.dropdown_id),o=a("#"+t.params_html.input_id),parseInt(l.val())!==W){if(o.val(a.trim(o.val())),o.val()&&(_a.text_inputs_contain_value=!0),_a.ajax_data_to_pass[t.params_html.input_id]=o.val(),parseInt(l.val())===V&&o.val())return _a.error=t.params_html.msg_missing_operator,_a.focus=t.params_html.dropdown_id,!1;if(parseInt(l.val())!==V&&!o.val())return _a.error=t.params_html.msg_missing_value,_a.focus=t.params_html.input_id,!1;if(parseInt(l.val())!==V&&o.val()&&t.params_html.hasOwnProperty("minchars")&&t.params_html.minchars&&o.val().length<t.params_html.minchars)return _a.error=t.params_html.msg_minchars,_a.focus=t.params_html.input_id,!1}break;case"lookup":break;case"date":if(l=a("#"+t.params_html.dropdown_id),o=a("#"+t.params_html.input_id),parseInt(l.val())!==aa){if(o.val(a.trim(o.val())),o.val()&&(_a.text_inputs_contain_value=!0),_a.ajax_data_to_pass[t.params_html.dropdown_id]=l.val(),_a.ajax_data_to_pass[t.params_html.input_id]=o.val(),parseInt(l.val())===Z&&o.val())return _a.error=t.params_html.msg_missing_operator,_a.focus=t.params_html.dropdown_id,!1;if(parseInt(l.val())!==Z&&!o.val())return _a.error=t.params_html.msg_missing_value,_a.focus=t.params_html.input_id,!1}break;case"autocomplete":break;case"multiselect_checkbox":var r=0;if(a.each(t.params_html.items,function(e,t){a("#"+t.input_id).prop("checked")===!0&&(r+=1)}),0===r)return _a.error=t.params_html.msg_all_deselected,_a.focus=t.params_html.items[0].input_id,!1}})};ia("text"),ia("lookup"),ia("date"),b.click(function(){_.ajax_reset_all_url?a.ajax({url:_.ajax_reset_all_url,type:"POST",dataType:"json",success:function(a){location.href=a.current_url}}):location.href=location.href.split("?")[0]}),w.change(function(){ca("rows_per_page")}),x.click(function(){ca("columns_switcher")}),j.click(function(){location.href=_.addnew_record_url}),S.click(function(){ca("sort_simple",{col_id:a(this).attr("id")})}),O.change(function(){ca("sort_advanced")}),A.click(function(){ca("go_top")}),P.click(function(){ca("go_back")}),q.click(function(){ca("go_forward")}),C.click(function(){ca("go_bottom")}),T.click(function(){ca("go_to_page")}),z.keypress(function(a){13===a.which&&(a.preventDefault(),T.click())}),E.click(function(){ca("export_excel")}),a.each(ta,function(e,t){switch(t.type){case"text":l=a("#"+t.params_html.dropdown_id),o=a("#"+t.params_html.input_id),l.change(function(){ia("text")}),o.keypress(function(a){13===a.which&&(a.preventDefault(),B.click())});break;case"lookup":l=a("#"+t.params_html.dropdown_id),o=a("#"+t.params_html.dropdown_lookup_id),l.change(function(){ia("lookup")});break;case"date":l=a("#"+t.params_html.dropdown_id),o=a("#"+t.params_html.input_id),p=t.params_html.datepicker_params,t.params_html.hasOwnProperty("show_time")&&t.params_html.show_time===!0?o.datetimepicker(p):o.datepicker(p),l.change(function(){ia("date")}),o.keypress(function(a){13===a.which&&(a.preventDefault(),B.click())});break;case"autocomplete":n=a("#"+t.params_html.filter_id),c=a("#"+t.params_html.autocomplete_id),d=t.params_html.autocomplete_params,d.select=function(a,e){n.val(e.item.id)},d.change=function(a,e){null===e.item&&(c.val(""),n.val(""))},c.autocomplete(d),c.on("input",function(){n.val("")}),c.on("open",function(){a(".ui-autocomplete").css("width",c.css("width"))});break;case"multiselect_checkbox":}}),B.click(function(){ca("apply_criteria")}),F.click(function(){a.each(ta,function(a){oa(a)}),ia("text"),ia("lookup"),ia("date")}),G.click(function(){ca("clear_criteria")});var pa=function(){J.val(f),g.submit()},ca=function(e,t){if(a.each(ta,function(e,t){"autocomplete"===t.type&&(n=a("#"+t.params_html.filter_id),c=a("#"+t.params_html.autocomplete_id),n.val()||c.val(""))}),"export_excel"===e?M.val(U):M.val(R),f=h.serialize(),k=v!==f,"apply_criteria"===e){if(!k)return na(_.bs_modal_id,_.bs_modal_content_id,_.msg_criteria_not_changed),!1;if(sa(),_a.error)return na(_.bs_modal_id,_.bs_modal_content_id,_a.error,_a.focus),_a={error:null,focus:null,text_inputs_contain_value:null,ajax_data_to_pass:{}},!1;_a.text_inputs_contain_value&&_.ajax_validate_form_url?a.ajax({url:_.ajax_validate_form_url,type:"POST",data:_a.ajax_data_to_pass,dataType:"json",success:function(a){return a.error?(na(_.bs_modal_id,_.bs_modal_content_id,a.error,a.focus),_a={error:null,focus:null,text_inputs_contain_value:null,ajax_data_to_pass:{}},!1):(z.val(_.default_page_num),void pa())}}):(z.val(_.default_page_num),pa())}else{if("clear_criteria"===e)z.val(_.default_page_num),a.each(ta,function(a){la(a)}),ia("text"),ia("lookup"),ia("date"),f=h.serialize();else{if(k)return"rows_per_page"===e&&w.val(ea),na(_.bs_modal_id,_.bs_modal_content_id,_.msg_apply_or_reset_criteria,_.criteria_apply_id),!1;switch(e){case"rows_per_page":z.val(K);break;case"columns_switcher":parseInt(y.val())===L?y.val(N):y.val(L);break;case"sort_simple":I.val()===t.col_id?"ASC"===D.val()?D.val("DESC"):D.val("ASC"):(I.val(t.col_id),D.val("ASC"));break;case"sort_advanced":I.val(""),D.val("");break;case"go_top":z.val(K);break;case"go_back":z.val(+z.val()-1);break;case"go_forward":z.val(+z.val()+1);break;case"go_bottom":z.val(Q.val());break;case"go_to_page":}}pa()}},na=function(e,t,r,_){var i=a("#"+e),o=a("#"+t);if(_){var l=a("#"+_);i.on("hidden.bs.modal",function(){l.focus()})}o.html(r),i.modal("show")}})},getOption:function(a){var t=this;return t.data(e)[a]},getDefaults:function(){return{php_bs_grid_form_id:"php_bs_grid_form",reset_all_id:"reset_all",rows_per_page_id:"rows_per_page",columns_switcher_id:"columns_switcher",columns_to_display_id:"columns_to_display",addnew_record_id:"addnew_record",col_sortable_selector:"th.col-sortable",sort_simple_field_id:"sort_simple_field",sort_simple_order_id:"sort_simple_order",sort_advanced_id:"sort_advanced",go_top_id:"go_top",go_back_id:"go_back",go_forward_id:"go_forward",go_bottom_id:"go_bottom",go_to_page_id:"go_to_page",page_num_id:"page_num",total_pages_id:"total_pages",export_excel_btn_id:"export_excel_btn",export_excel_id:"export_excel",criteria_apply_id:"criteria_apply",criteria_reset_id:"criteria_reset",criteria_clear_id:"criteria_clear",criteria_before_id:"criteria_before",criteria_after_id:"criteria_after",default_page_num:1,columns_default:1,columns_more:2,export_excel_no:1,export_excel_yes:2,criteria_operator_text_ignore:1,criteria_operator_text_isnull:5,criteria_operator_lookup_ignore:1,criteria_operator_lookup_equal:2,criteria_operator_date_ignore:1,criteria_operator_date_equal:2,criteria_operator_date_isnull:5}}};a.fn.php_bs_grid=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?void a.error("Method "+r+" does not exist on jQuery."+e):t.init.apply(this,arguments)}}(jQuery);